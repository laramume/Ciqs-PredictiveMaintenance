   {
    "contentVersion": "1.0.0.0",
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "parameters": {
        "mlFunctionEndpoint": {
            "type": "string",
            "metadata": {
                "description": "End point of ML Web Service"
            }
        },
        "mlFunctionApiKey": {
            "type": "string",
            "metadata": {
                "description": "Api key of ML Web Service"
            }
        },
        "sqlServerName": {
            "type": "string",
            "metadata": {
                "description": "SQL Server Name"
            }
        },
        "databaseName": {
            "type": "string",
            "metadata": {
                "description": "Database Name"
            }
        },
        "sqlServerUserName": {
            "type": "string",
            "metadata": {
                "description": "SQL Server User Name"
            }
        },
        "sqlServerPassword": {
            "type": "securestring",
            "metadata": {
                "description": "SQL Server Password"
            }
        },
        "storageAccountName": {
            "type": "string",
            "metadata": {
                "description": "Storage Account Name"
            }
        },
        "storageAccountKey": {
            "type": "string",
            "metadata": {
                "description": "Storage Account Key"
            }
        },
        "sharedAccessPolicyKey": {
            "type": "string",
            "metadata": {
                "description": "Shared Access Policy Key"
            }
        },
        "powerBiUserId": {
            "type": "string",
            "metadata": {
                "description": "User ID for PowerBI"
            }
        },
        "powerBiUserDisplayName": {
            "type": "string",
            "metadata": {
                "description": "User display name for PowerBI"
            }
        }
    },
    "variables": {
        "namePrefix": "[resourceGroup().name]",
        "uniqueNamePrefix": "[concat(variables('namePrefix'), uniqueString(subscription().subscriptionId))]",
        "location": "[resourceGroup().location]",
        "adfLocation": "North Europe",
        "saVersion": "2015-06-01",
        "dfVersion": "2015-10-01",
        "sbVersion": "2014-09-01",
        "dataFactoryName": "[concat(variables('uniqueNamePrefix'),'ADF')]",
        "storageAccountName": "[parameters('storageAccountName')]",
        "sqlServerName": "[parameters('sqlServerName')]",
        "databaseName": "pmaintenancedb",
        "namespaceName": "[concat(variables('uniqueNamePrefix'),'ns')]",
        "ingestEventHubName": "[concat(variables('namePrefix'),'eh')]",
        "blobConsumerGroupName": "[concat(variables('namePrefix'),'blobcg')]",
        "pbiConsumerGroupName": "[concat(variables('namePrefix'),'pbicg')]",
        "functionAppName":"{Outputs.functionAppName}",
        "sbKeyName": "RootManageSharedAccessKey",
        "blobStreamingJobName": "[concat(variables('namePrefix'),'saBlob')]",
        "pbiStreamingJobName": "[concat(variables('namePrefix'),'saPbi')]",
        "powerBiRefreshToken": "none",
        "powerBiGroupId": "00000000-0000-0000-0000-000000000000",
        "powerBiWorkspaceName": "My Workspace",
        "startTime": "2015-05-01T00:00:00Z",
        "endTime": "2016-05-01T00:00:00Z",
        "nowTime": "2016-05-15T03:00:00Z",
        "nowPlusTenYearsTime": "2026-05-15T03:00:00Z",
            
        "dataContainerName": "maintenancesadata",
        "scriptContainerName": "maintenancesascript",
        "azureSqlLinkedServiceName": "AzureSqlLinkedService",
        "storageLinkedServiceName": "StorageLinkedService",
        "hdInsightStorageLinkedServiceName": "HDInsightStorageLinkedService",
        "hdInsightLinkedServiceName": "HDInsightLinkedService",
        "AzureMLLinkedServiceName": "AzuremLEndpointBatchLocation",
        "hdInsightLiveTime": "3:00:00",

        "PartitioneRawDataName": "flightrawdata1sec",
        "PartitioneRawDataBlobDir": "[concat('wasb://',variables('dataContainerName'), '@',variables('storageAccountName'),'.blob.core.windows.net/rawdata')]",
        "PartitioneRawDataADFTableName": "PartitioneRawDataTable",
        "AggFlightInfoDataName": "aggflightinfo",
        "AggFlightInfoDataBlobDir": "[concat('wasb://',variables('dataContainerName'), '@',variables('storageAccountName'),'.blob.core.windows.net/aggregated/', variables('AggFlightInfoDataName'), '/')]",
        "AggFlightInfoDataADFTableName": "AggFlightInfoDataTable",
        "AggregateFlightInfoADFPipelineName": "[concat(variables('namePrefix'),'AggregateFlightInfoPipeline')]",
        "AggregateFlightInfoHiveFile": "AggregateFlightInfo.hql",
        "PrepareMLInputHiveFile": "PrepareMLInput.hql",
        "IntermediateMLInputDataName": "mldata",
        "IntermediateMLInputDataBlobDir": "[concat('wasb://',variables('dataContainerName'), '@',variables('storageAccountName'),'.blob.core.windows.net/intermediate/', variables('IntermediateMLInputDataName'))]",
        "IntermediateMLInputDataADFTableName": "IntermediateMLInputDataTable",
        "IntermediateMLInputDataCSVName": "mlcsvdata",
        "IntermediateMLInputDataCSVBlobDir": "[concat('wasb://',variables('dataContainerName'), '@',variables('storageAccountName'),'.blob.core.windows.net/intermediate/', variables('IntermediateMLInputDataCSVName'), '/')]",
        "IntermediateMLInputDataCSVADFTableName": "IntermediateMLInputDataCSVTable",
        "MLScoringADFPipelineName": "[concat(variables('namePrefix'),'MLScoringPipeline')]",
        "ScoredResultName": "scoredresult",
        "ScoredResultBlobDir": "[concat('wasb://',variables('dataContainerName'), '@',variables('storageAccountName'),'.blob.core.windows.net/', variables('ScoredResultName'), '/')]",
        "ScoredResultADFTableName": "ScoredResultTable",
        "CopyAggFlightInfoDataADFPipelineName": "CopyAggFlightInfoADFPipeline",
        "CopyScoredResultADFPipelineName": "CopyScoredResultPipeline",
        "SQLFlightInfoDataADFTableName": "SQLFlightInfoDataTable",
        "SQLScoredResultADFTableName": "SQLScoredResultTable",
        "SQLAggFlightInfoDataADFTableName": "SQLAggFlightInfoDataADFTable"
    },
    "resources": [
         {
            "name": "[variables('dataFactoryName')]",
            "apiVersion": "[variables('dfVersion')]",
            "type": "Microsoft.DataFactory/datafactories",
            "location": "[variables('adfLocation')]",
            "resources": [
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]"
                    ],
                    "type": "linkedservices",
                    "name": "[variables('azureSqlLinkedServiceName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "type": "AzureSqlDatabase",
                        "typeProperties": {
                            "connectionString": "[concat('Server=tcp:',variables('sqlServerName'),'.database.windows.net,1433;Database=',variables('databasename'),';User ID=',parameters('sqlServerUserName'),';Password=',parameters('sqlServerPassword'),';Trusted_Connection=False;Encrypt=True;Connection Timeout=30')]"
                        }
                    }
                },
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]"
                    ],
                    "type": "linkedservices",
                    "name": "[variables('storageLinkedServiceName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "type": "AzureStorage",
                        "typeProperties": {
                            "connectionString": "[concat('DefaultEndpointsProtocol=https;AccountName=',variables('storageAccountName'),';AccountKey=', parameters('storageAccountKey'))]"
                        }
                    }
                },
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]"
                    ],
                    "type": "linkedservices",
                    "name": "[variables('hdInsightStorageLinkedServiceName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "type": "AzureStorage",
                        "typeProperties": {
                            "connectionString": "[concat('DefaultEndpointsProtocol=https;AccountName=',variables('storageAccountName'),';AccountKey=', parameters('storageAccountKey'))]"
                        }
                    }
                },
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/linkedservices/', variables('hdInsightStorageLinkedServiceName'))]"
                    ],
                    "type": "linkedservices",
                    "name": "[variables('hdInsightLinkedServiceName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "type": "HDInsightOnDemand",
                        "typeProperties": {
                            "clusterSize": "1",
                            "jobsContainer": "adfjobs",
                            "timeToLive": "[variables('hdInsightLiveTime')]",
                            "linkedServiceName": "[variables('hdInsightStorageLinkedServiceName')]"
                        }
                    }
                },
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]"
                    ],
                    "type": "linkedservices",
                    "name": "[variables('AzureMLLinkedServiceName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "type": "AzureML",
                        "typeProperties": {
                            "mLEndpoint": "[concat(parameters('mlFunctionEndpoint'), '/jobs')]",
                            "apiKey": "[parameters('mlFunctionApiKey')]"
                        }
                    }
                },
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/linkedServices/', variables('storageLinkedServiceName'))]"
                    ],
                    "type": "datasets",
                    "name": "[variables('PartitioneRawDataADFTableName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "structure": [
                            {
                                "name": "processed",
                                "type": "String"
                            },
                            {
                                "name": "id",
                                "type": "String"
                            },
                            {
                                "name": "cycle",
                                "type": "String"
                            },
                            {
                                "name": "counter",
                                "type": "String"
                            },
                            {
                                "name": "endofcycle",
                                "type": "String"
                            },
                            {
                                "name": "setting1",
                                "type": "String"
                            },
                            {
                                "name": "setting2",
                                "type": "String"
                            },
                            {
                                "name": "setting3",
                                "type": "String"
                            },
                            {
                                "name": "s1",
                                "type": "String"
                            },
                            {
                                "name": "s2",
                                "type": "String"
                            },
                            {
                                "name": "s3",
                                "type": "String"
                            },
                            {
                                "name": "s4",
                                "type": "String"
                            },
                            {
                                "name": "s5",
                                "type": "String"
                            },
                            {
                                "name": "s6",
                                "type": "String"
                            },
                            {
                                "name": "s7",
                                "type": "String"
                            },
                            {
                                "name": "s8",
                                "type": "String"
                            },
                            {
                                "name": "s9",
                                "type": "String"
                            },
                            {
                                "name": "s10",
                                "type": "String"
                            },
                            {
                                "name": "s11",
                                "type": "String"
                            },
                            {
                                "name": "s12",
                                "type": "String"
                            },
                            {
                                "name": "s13",
                                "type": "String"
                            },
                            {
                                "name": "s14",
                                "type": "String"
                            },
                            {
                                "name": "s15",
                                "type": "String"
                            },
                            {
                                "name": "s16",
                                "type": "String"
                            },
                            {
                                "name": "s17",
                                "type": "String"
                            },
                            {
                                "name": "s18",
                                "type": "String"
                            },
                            {
                                "name": "s19",
                                "type": "String"
                            },
                            {
                                "name": "s20",
                                "type": "String"
                            },
                            {
                                "name": "s21",
                                "type": "String"
                            }
                        ],
                        "type": "AzureBlob",
                        "linkedServiceName": "StorageLinkedService",
                        "typeProperties": {
                            "folderPath": "[concat(variables('dataContainerName'),'/rawdata/date={Year}-{Month}-{Day}/hour={Hour}')]",
                            "partitionedBy": [
                                {
                                    "name": "Year",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "yyyy"
                                    }
                                },
                                {
                                    "name": "Month",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "MM"
                                    }
                                },
                                {
                                    "name": "Day",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "dd"
                                    }
                                },
                                {
                                    "name": "Hour",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "HH"
                                    }
                                }
                            ]
                        },
                        "availability": {
                            "frequency": "hour",
                            "interval": 3,
                            "style": "startofinterval"
                        },
                        "external": true,
                        "policy": {
                            "externalData": {
                                "dataDelay": "00:01:00",
                                "retryInterval": "00:01:00",
                                "retryTimeout": "00:20:00",
                                "maximumRetry": 3
                            }
                        }
                    }
                },
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/linkedServices/', variables('storageLinkedServiceName'))]"
                    ],
                    "type": "datasets",
                    "name": "[variables('AggFlightInfoDataADFTableName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "structure": [
                            {
                                "name": "aggredatedt",
                                "type": "String"
                            },
                            {
                                "name": "id",
                                "type": "String"
                            },
                            {
                                "name": "cycle",
                                "type": "String"
                            },
                            {
                                "name": "counter",
                                "type": "String"
                            },
                            {
                                "name": "endofcycle",
                                "type": "String"
                            },
                            {
                                "name": "setting1",
                                "type": "String"
                            },
                            {
                                "name": "setting2",
                                "type": "String"
                            },
                            {
                                "name": "setting3",
                                "type": "String"
                            },
                            {
                                "name": "s1",
                                "type": "String"
                            },
                            {
                                "name": "s2",
                                "type": "String"
                            },
                            {
                                "name": "s3",
                                "type": "String"
                            },
                            {
                                "name": "s4",
                                "type": "String"
                            },
                            {
                                "name": "s5",
                                "type": "String"
                            },
                            {
                                "name": "s6",
                                "type": "String"
                            },
                            {
                                "name": "s7",
                                "type": "String"
                            },
                            {
                                "name": "s8",
                                "type": "String"
                            },
                            {
                                "name": "s9",
                                "type": "String"
                            },
                            {
                                "name": "s10",
                                "type": "String"
                            },
                            {
                                "name": "s11",
                                "type": "String"
                            },
                            {
                                "name": "s12",
                                "type": "String"
                            },
                            {
                                "name": "s13",
                                "type": "String"
                            },
                            {
                                "name": "s14",
                                "type": "String"
                            },
                            {
                                "name": "s15",
                                "type": "String"
                            },
                            {
                                "name": "s16",
                                "type": "String"
                            },
                            {
                                "name": "s17",
                                "type": "String"
                            },
                            {
                                "name": "s18",
                                "type": "String"
                            },
                            {
                                "name": "s19",
                                "type": "String"
                            },
                            {
                                "name": "s20",
                                "type": "String"
                            },
                            {
                                "name": "s21",
                                "type": "String"
                            }
                        ],
                        "type": "AzureBlob",
                        "linkedServiceName": "StorageLinkedService",
                        "typeProperties": {
                            "folderPath": "[concat(variables('dataContainerName'),'/aggregated/', variables('AggFlightInfoDataName'),'/date={Year}-{Month}-{Day}/hour={Hour}')]",
                            "partitionedBy": [
                                {
                                    "name": "Year",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "yyyy"
                                    }
                                },
                                {
                                    "name": "Month",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "MM"
                                    }
                                },
                                {
                                    "name": "Day",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "dd"
                                    }
                                },
                                {
                                    "name": "Hour",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "HH"
                                    }
                                }
                            ]
                        },
                        "availability": {
                            "frequency": "hour",
                            "interval": 3,
                            "style": "startofinterval"
                        }
                    }
                },
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/linkedServices/', variables('storageLinkedServiceName'))]"
                    ],
                    "type": "datasets",
                    "name": "[variables('IntermediateMLInputDataADFTableName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "structure": [
                            {
                                "name": "id",
                                "type": "String"
                            },
                            {
                                "name": "cycle",
                                "type": "String"
                            },
                            {
                                "name": "setting1",
                                "type": "String"
                            },
                            {
                                "name": "setting2",
                                "type": "String"
                            },
                            {
                                "name": "setting3",
                                "type": "String"
                            },
                            {
                                "name": "s1",
                                "type": "String"
                            },
                            {
                                "name": "s2",
                                "type": "String"
                            },
                            {
                                "name": "s3",
                                "type": "String"
                            },
                            {
                                "name": "s4",
                                "type": "String"
                            },
                            {
                                "name": "s5",
                                "type": "String"
                            },
                            {
                                "name": "s6",
                                "type": "String"
                            },
                            {
                                "name": "s7",
                                "type": "String"
                            },
                            {
                                "name": "s8",
                                "type": "String"
                            },
                            {
                                "name": "s9",
                                "type": "String"
                            },
                            {
                                "name": "s10",
                                "type": "String"
                            },
                            {
                                "name": "s11",
                                "type": "String"
                            },
                            {
                                "name": "s12",
                                "type": "String"
                            },
                            {
                                "name": "s13",
                                "type": "String"
                            },
                            {
                                "name": "s14",
                                "type": "String"
                            },
                            {
                                "name": "s15",
                                "type": "String"
                            },
                            {
                                "name": "s16",
                                "type": "String"
                            },
                            {
                                "name": "s17",
                                "type": "String"
                            },
                            {
                                "name": "s18",
                                "type": "String"
                            },
                            {
                                "name": "s19",
                                "type": "String"
                            },
                            {
                                "name": "s20",
                                "type": "String"
                            },
                            {
                                "name": "s21",
                                "type": "String"
                            },
                            {
                                "name": "a1",
                                "type": "String"
                            },
                            {
                                "name": "a2",
                                "type": "String"
                            },
                            {
                                "name": "a3",
                                "type": "String"
                            },
                            {
                                "name": "a4",
                                "type": "String"
                            },
                            {
                                "name": "a5",
                                "type": "String"
                            },
                            {
                                "name": "a6",
                                "type": "String"
                            },
                            {
                                "name": "a7",
                                "type": "String"
                            },
                            {
                                "name": "a8",
                                "type": "String"
                            },
                            {
                                "name": "a9",
                                "type": "String"
                            },
                            {
                                "name": "a10",
                                "type": "String"
                            },
                            {
                                "name": "a11",
                                "type": "String"
                            },
                            {
                                "name": "a12",
                                "type": "String"
                            },
                            {
                                "name": "a13",
                                "type": "String"
                            },
                            {
                                "name": "a14",
                                "type": "String"
                            },
                            {
                                "name": "a15",
                                "type": "String"
                            },
                            {
                                "name": "a16",
                                "type": "String"
                            },
                            {
                                "name": "a17",
                                "type": "String"
                            },
                            {
                                "name": "a18",
                                "type": "String"
                            },
                            {
                                "name": "a19",
                                "type": "String"
                            },
                            {
                                "name": "a20",
                                "type": "String"
                            },
                            {
                                "name": "a21",
                                "type": "String"
                            },
                            {
                                "name": "sd1",
                                "type": "String"
                            },
                            {
                                "name": "sd2",
                                "type": "String"
                            },
                            {
                                "name": "sd3",
                                "type": "String"
                            },
                            {
                                "name": "sd4",
                                "type": "String"
                            },
                            {
                                "name": "sd5",
                                "type": "String"
                            },
                            {
                                "name": "sd6",
                                "type": "String"
                            },
                            {
                                "name": "sd7",
                                "type": "String"
                            },
                            {
                                "name": "sd8",
                                "type": "String"
                            },
                            {
                                "name": "sd9",
                                "type": "String"
                            },
                            {
                                "name": "sd10",
                                "type": "String"
                            },
                            {
                                "name": "sd11",
                                "type": "String"
                            },
                            {
                                "name": "sd12",
                                "type": "String"
                            },
                            {
                                "name": "sd13",
                                "type": "String"
                            },
                            {
                                "name": "sd14",
                                "type": "String"
                            },
                            {
                                "name": "sd15",
                                "type": "String"
                            },
                            {
                                "name": "sd16",
                                "type": "String"
                            },
                            {
                                "name": "sd17",
                                "type": "String"
                            },
                            {
                                "name": "sd18",
                                "type": "String"
                            },
                            {
                                "name": "sd19",
                                "type": "String"
                            },
                            {
                                "name": "sd20",
                                "type": "String"
                            },
                            {
                                "name": "sd21",
                                "type": "String"
                            }
                        ],
                        "type": "AzureBlob",
                        "linkedServiceName": "[variables('storageLinkedServiceName')]",
                        "typeProperties": {
                            "folderPath": "[concat(variables('dataContainerName'),'/intermediate/', variables('IntermediateMLInputDataName'),'/date={Year}-{Month}-{Day}/hour={Hour}/')]",
                            "format": {
                                "type": "TextFormat",
                                "columnDelimiter": ","
                            },
                            "partitionedBy": [
                                {
                                    "name": "Year",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "yyyy"
                                    }
                                },
                                {
                                    "name": "Month",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "MM"
                                    }
                                },
                                {
                                    "name": "Day",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "dd"
                                    }
                                },
                                {
                                    "name": "Hour",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "HH"
                                    }
                                }
                            ]
                        },
                        "availability": {
                            "frequency": "Hour",
                            "interval": 3,
                            "style": "StartOfInterval"
                        }
                    }
                },
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/linkedServices/', variables('storageLinkedServiceName'))]"
                    ],
                    "type": "datasets",
                    "name": "[variables('IntermediateMLInputDataCSVADFTableName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "structure": [
                            {
                                "name": "id",
                                "type": "String"
                            },
                            {
                                "name": "cycle",
                                "type": "String"
                            },
                            {
                                "name": "setting1",
                                "type": "String"
                            },
                            {
                                "name": "setting2",
                                "type": "String"
                            },
                            {
                                "name": "setting3",
                                "type": "String"
                            },
                            {
                                "name": "s1",
                                "type": "String"
                            },
                            {
                                "name": "s2",
                                "type": "String"
                            },
                            {
                                "name": "s3",
                                "type": "String"
                            },
                            {
                                "name": "s4",
                                "type": "String"
                            },
                            {
                                "name": "s5",
                                "type": "String"
                            },
                            {
                                "name": "s6",
                                "type": "String"
                            },
                            {
                                "name": "s7",
                                "type": "String"
                            },
                            {
                                "name": "s8",
                                "type": "String"
                            },
                            {
                                "name": "s9",
                                "type": "String"
                            },
                            {
                                "name": "s10",
                                "type": "String"
                            },
                            {
                                "name": "s11",
                                "type": "String"
                            },
                            {
                                "name": "s12",
                                "type": "String"
                            },
                            {
                                "name": "s13",
                                "type": "String"
                            },
                            {
                                "name": "s14",
                                "type": "String"
                            },
                            {
                                "name": "s15",
                                "type": "String"
                            },
                            {
                                "name": "s16",
                                "type": "String"
                            },
                            {
                                "name": "s17",
                                "type": "String"
                            },
                            {
                                "name": "s18",
                                "type": "String"
                            },
                            {
                                "name": "s19",
                                "type": "String"
                            },
                            {
                                "name": "s20",
                                "type": "String"
                            },
                            {
                                "name": "s21",
                                "type": "String"
                            },
                            {
                                "name": "a1",
                                "type": "String"
                            },
                            {
                                "name": "a2",
                                "type": "String"
                            },
                            {
                                "name": "a3",
                                "type": "String"
                            },
                            {
                                "name": "a4",
                                "type": "String"
                            },
                            {
                                "name": "a5",
                                "type": "String"
                            },
                            {
                                "name": "a6",
                                "type": "String"
                            },
                            {
                                "name": "a7",
                                "type": "String"
                            },
                            {
                                "name": "a8",
                                "type": "String"
                            },
                            {
                                "name": "a9",
                                "type": "String"
                            },
                            {
                                "name": "a10",
                                "type": "String"
                            },
                            {
                                "name": "a11",
                                "type": "String"
                            },
                            {
                                "name": "a12",
                                "type": "String"
                            },
                            {
                                "name": "a13",
                                "type": "String"
                            },
                            {
                                "name": "a14",
                                "type": "String"
                            },
                            {
                                "name": "a15",
                                "type": "String"
                            },
                            {
                                "name": "a16",
                                "type": "String"
                            },
                            {
                                "name": "a17",
                                "type": "String"
                            },
                            {
                                "name": "a18",
                                "type": "String"
                            },
                            {
                                "name": "a19",
                                "type": "String"
                            },
                            {
                                "name": "a20",
                                "type": "String"
                            },
                            {
                                "name": "a21",
                                "type": "String"
                            },
                            {
                                "name": "sd1",
                                "type": "String"
                            },
                            {
                                "name": "sd2",
                                "type": "String"
                            },
                            {
                                "name": "sd3",
                                "type": "String"
                            },
                            {
                                "name": "sd4",
                                "type": "String"
                            },
                            {
                                "name": "sd5",
                                "type": "String"
                            },
                            {
                                "name": "sd6",
                                "type": "String"
                            },
                            {
                                "name": "sd7",
                                "type": "String"
                            },
                            {
                                "name": "sd8",
                                "type": "String"
                            },
                            {
                                "name": "sd9",
                                "type": "String"
                            },
                            {
                                "name": "sd10",
                                "type": "String"
                            },
                            {
                                "name": "sd11",
                                "type": "String"
                            },
                            {
                                "name": "sd12",
                                "type": "String"
                            },
                            {
                                "name": "sd13",
                                "type": "String"
                            },
                            {
                                "name": "sd14",
                                "type": "String"
                            },
                            {
                                "name": "sd15",
                                "type": "String"
                            },
                            {
                                "name": "sd16",
                                "type": "String"
                            },
                            {
                                "name": "sd17",
                                "type": "String"
                            },
                            {
                                "name": "sd18",
                                "type": "String"
                            },
                            {
                                "name": "sd19",
                                "type": "String"
                            },
                            {
                                "name": "sd20",
                                "type": "String"
                            },
                            {
                                "name": "sd21",
                                "type": "String"
                            }
                        ],
                        "published": false,
                        "type": "AzureBlob",
                        "linkedServiceName": "[variables('storageLinkedServiceName')]",
                        "typeProperties": {
                            "folderPath": "[concat(variables('dataContainerName'),'/intermediate/', variables('IntermediateMLInputDataCSVName'),'/date={Year}-{Month}-{Day}/hour={Hour}/')]",
                            "fileName": "[concat(variables('IntermediateMLInputDataCSVName'),'.csv')]",
                            "format": {
                                "type": "TextFormat",
                                "columnDelimiter": ","
                            },
                            "partitionedBy": [
                                {
                                    "name": "Year",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "yyyy"
                                    }
                                },
                                {
                                    "name": "Month",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "MM"
                                    }
                                },
                                {
                                    "name": "Day",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "dd"
                                    }
                                },
                                {
                                    "name": "Hour",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "HH"
                                    }
                                }
                            ]
                        },
                        "availability": {
                            "frequency": "hour",
                            "interval": 3,
                            "style": "StartOfInterval"
                        }
                    }
                },
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/linkedServices/', variables('storageLinkedServiceName'))]"
                    ],
                    "type": "datasets",
                    "name": "[variables('ScoredResultADFTableName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "structure": [
                            {
                                "name": "Id",
                                "type": "String"
                            },
                            {
                                "name": "Cycle",
                                "type": "String"
                            },
                            {
                                "name": "Rul",
                                "type": "String"
                            }
                        ],
                        "type": "AzureBlob",
                        "linkedServiceName": "StorageLinkedService",
                        "typeProperties": {
                            "folderPath": "[concat(variables('dataContainerName'),'/',variables('ScoredResultName'),'/date={Year}-{Month}-{Day}/hour={Hour}/')]",
                            "filename": "[concat(variables('ScoredResultName'),'.csv')]",
                            "partitionedBy": [
                                {
                                    "name": "Year",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "yyyy"
                                    }
                                },
                                {
                                    "name": "Month",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "MM"
                                    }
                                },
                                {
                                    "name": "Day",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "dd"
                                    }
                                },
                                {
                                    "name": "Hour",
                                    "value": {
                                        "type": "DateTime",
                                        "date": "SliceStart",
                                        "format": "HH"
                                    }
                                }
                            ],
                            "format": {
                                "type": "TextFormat",
                                "columnDelimiter": ","
                            }
                        },
                        "availability": {
                            "frequency": "Hour",
                            "interval": 3,
                            "style": "startofinterval"
                        }
                    }
                },
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/linkedServices/', variables('azureSqlLinkedServiceName'))]"
                    ],
                    "type": "datasets",
                    "name": "[variables('SQLScoredResultADFTableName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "structure": [
                            {
                                "name": "Id",
                                "type": "String"
                            },
                            {
                                "name": "Cycle",
                                "type": "String"
                            },
                            {
                                "name": "Rul",
                                "type": "String"
                            }
                        ],
                        "published": false,
                        "type": "AzureSqlTable",
                        "linkedServiceName": "AzureSqlLinkedService",
                        "typeProperties": {
                            "tableName": "PMResult"
                        },
                        "availability": {
                            "frequency": "hour",
                            "interval": 3,
                            "style": "StartOfInterval"
                        }
                    }
                },
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/linkedServices/', variables('storageLinkedServiceName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/linkedServices/', variables('hdInsightLinkedServiceName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/datasets/', variables('PartitioneRawDataADFTableName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/datasets/', variables('AggFlightInfoDataADFTableName'))]"
                    ],
                    "type": "datapipelines",
                    "name": "[variables('AggregateFlightInfoADFPipelineName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "description": "This is a pipeline to aggregate the 30 seconds raw data(partitioned by ASA) to 1hr in substation level",
                        "start": "[variables('nowTime')]",
                        "end": "[variables('nowPlusTenYearsTime')]",
                        "activities": [
                            {
                                "name": "BlobPartitionHiveActivity",
                                "inputs": [
                                    {
                                        "name": "[variables('PartitioneRawDataADFTableName')]"
                                    }
                                ],
                                "outputs": [
                                    {
                                        "name": "[variables('AggFlightInfoDataADFTableName')]"
                                    }
                                ],
                                "linkedServiceName": "[variables('hdInsightLinkedServiceName')]",
                                "type": "HDInsightHive",
                                "typeProperties": {
                                    "scriptpath": "[concat(variables('scriptContainerName'), '\\', variables('AggregateFlightInfoHiveFile'))]",
                                    "scriptLinkedService": "StorageLinkedService",
                                    "defines": {
                                        "RAWINPUT": "[variables('PartitioneRawDataBlobDir')]",
                                        "AGGREGATEDOUTPUT": "[variables('AggFlightInfoDataBlobDir')]",
                                        "Date1": "$$Text.Format('{0:yyyy-MM-dd}',Time.AddMinutes(SliceStart, -180))",
                                        "Hour1": "$$Text.Format('{0:HH}',Time.AddMinutes(SliceStart, -180))",
                                        "Date2": "$$Text.Format('{0:yyyy-MM-dd}',Time.AddMinutes(SliceStart, -120))",
                                        "Hour2": "$$Text.Format('{0:HH}',Time.AddMinutes(SliceStart, -120))",
                                        "Date3": "$$Text.Format('{0:yyyy-MM-dd}',Time.AddMinutes(SliceStart, -60))",
                                        "Hour3": "$$Text.Format('{0:HH}',Time.AddMinutes(SliceStart, -60))",
                                        "CurrentDate": "$$Text.Format('{0:yyyy-MM-dd}', SliceStart)",
                                        "CurrentHour": "$$Text.Format('{0:HH}',SliceStart)"
                                    }
                                },
                                "policy": {
                                    "concurrency": 1,
                                    "executionPriorityOrder": "OldestFirst",
                                    "retry": 3,
                                    "timeout": "01:00:00"
                                }
                            }
                        ]
                    }
                },
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/linkedServices/', variables('storageLinkedServiceName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/linkedServices/', variables('hdInsightLinkedServiceName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/datasets/', variables('AggFlightInfoDataADFTableName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/datasets/', variables('IntermediateMLInputDataADFTableName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/datasets/', variables('IntermediateMLInputDataCSVADFTableName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/datasets/', variables('ScoredResultADFTableName'))]"
                    ],
                    "type": "datapipelines",
                    "name": "[variables('MLScoringADFPipelineName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "description": "This is pipeline call ML scoring to make prediction",
                        "start": "[variables('nowTime')]",
                        "end": "[variables('nowPlusTenYearsTime')]",
                        "activities": [
                            {
                                "name": "SchemaPrepForML",
                                "inputs": [
                                    {
                                        "name": "[variables('AggFlightInfoDataADFTableName')]"
                                    }
                                ],
                                "outputs": [
                                    {
                                        "name": "[variables('IntermediateMLInputDataADFTableName')]"
                                    }
                                ],
                                "linkedServiceName": "HDInsightLinkedService",
                                "type": "HDInsightHive",
                                "typeProperties": {
                                    "scriptpath": "[concat(variables('scriptContainerName'), '\\', variables('PrepareMLInputHiveFile'))]",
                                    "scriptLinkedService": "StorageLinkedService",
                                    "defines": {
                                        "AGGREGATEDINPUT": "[variables('AggFlightInfoDataBlobDir')]",
                                        "PREPOUTPUT": "[variables('IntermediateMLInputDataBlobDir')]",
                                        "CurrentDate": "$$Text.Format('{0:yyyy-MM-dd}', SliceStart)",
                                        "CurrentHour": "$$Text.Format('{0:HH}',SliceStart)"
                                    }
                                },
                                "policy": {
                                    "concurrency": 1,
                                    "executionPriorityOrder": "OldestFirst",
                                    "retry": 3,
                                    "timeout": "01:00:00"
                                }
                            },
                            {
                                "name": "FileExtensionPrepforMLActivity",
                                "inputs": [
                                    {
                                        "name": "[variables('IntermediateMLInputDataADFTableName')]"
                                    }
                                ],
                                "outputs": [
                                    {
                                        "name": "[variables('IntermediateMLInputDataCSVADFTableName')]"
                                    }
                                ],
                                "type": "Copy",
                                "typeProperties": {
                                    "source": {
                                        "type": "BlobSource"
                                    },
                                    "sink": {
                                        "type": "BlobSink",
                                        "writeBatchSize": 10000,
                                        "writeBatchTimeout": "01:00:00"
                                    }
                                },
                                "policy": {
                                    "concurrency": 1,
                                    "executionPriorityOrder": "OldestFirst",
                                    "retry": 3,
                                    "timeout": "01:00:00"
                                }
                            },
                            {
                                "name": "AMLBatchScoring",
                                "inputs": [
                                    {
                                        "name": "[variables('IntermediateMLInputDataCSVADFTableName')]"
                                    }
                                ],
                                "outputs": [
                                    {
                                        "name": "[variables('ScoredResultADFTableName')]"
                                    }
                                ],
                                "type": "AzureMLBatchScoring",
                                "linkedServiceName": "[variables('AzureMLLinkedServiceName')]",
                                "policy": {
                                    "concurrency": 1,
                                    "executionPriorityOrder": "OldestFirst",
                                    "retry": 3,
                                    "timeout": "01:00:00"
                                }
                            }
                        ]
                    }
                },
                {
                    "dependsOn": [
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/linkedServices/', variables('azureSqlLinkedServiceName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/linkedServices/', variables('hdInsightLinkedServiceName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/datasets/', variables('ScoredResultADFTableName'))]",
                        "[concat('Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'), '/datasets/', variables('SQLScoredResultADFTableName'))]"
                    ],
                    "type": "datapipelines",
                    "name": "[variables('CopyScoredResultADFPipelineName')]",
                    "apiVersion": "[variables('dfVersion')]",
                    "properties": {
                        "description": "Copy predication to Sql Azure",
                        "start": "[variables('nowTime')]",
                        "end": "[variables('nowPlusTenYearsTime')]",
                        "activities": [
                            {
                                "type": "Copy",
                                "typeProperties": {
                                    "source": {
                                        "type": "BlobSource",
                                        "treatEmptyAsNull": true,
                                        "skipHeaderLineCount": 1
                                    },
                                    "sink": {
                                        "type": "SqlSink",
                                        "SqlWriterTableType": "PMResultType",
                                        "SqlWriterStoredProcedureName": "sp_loadScoreResult",
                                        "writeBatchSize": 0,
                                        "writeBatchTimeout": "01:00:00"
                                    }
                                },
                                "inputs": [
                                    {
                                        "name": "[variables('ScoredResultADFTableName')]"
                                    }
                                ],
                                "outputs": [
                                    {
                                        "name": "[variables('SQLScoredResultADFTableName')]"
                                    }
                                ],
                                "policy": {
                                    "timeout": "10:00:00",
                                    "concurrency": 1,
                                    "executionPriorityOrder": "OldestFirst",
                                    "retry": 3
                                },
                                "name": "CopyMLResulttoSqlAzure",
                                "description": "Copy ML result table to Sql Azure"
                            }
                        ]
                    }
                }
            ]
        },
        {
            "apiVersion": "[variables('saVersion')]",
            "type": "Microsoft.StreamAnalytics/streamingJobs",
            "name": "[variables('blobStreamingJobName')]",
            "location": "[variables('location')]",
            "properties": {
                "sku": {
                    "name": "standard"
                },
                "EventsOutOfOrderMaxDelayInSeconds": 10,
                "EventsOutOfOrderPolicy": "Adjust",
                "inputs": [
                    {
                        "name": "EventHubSource",
                        "properties": {
                            "type": "stream",
                            "Serialization": {
                                "Properties": {
                                    "fieldDelimiter": ",",
                                    "Encoding": "UTF8"
                                },
                                "Type": "Csv"
                            },
                            "datasource": {
                                "type": "Microsoft.ServiceBus/EventHub",
                                "properties": {
                                    "EventHubName": "[variables('ingestEventHubName')]",
                                    "ServiceBusNamespace": "[variables('namespaceName')]",
                                    "SharedAccessPolicyName": "[variables('sbKeyName')]",
                                    "SharedAccessPolicyKey": "[parameters('sharedAccessPolicyKey')]",
                                    "SourcePartitionCount": 16,
                                    "ConsumerGroupName": "[variables('blobConsumerGroupName')]"
                                }
                            }
                        }
                    }
                ],
                "Outputs": [
                    {
                        "Name": "RawDataBlobSink",
                        "Properties": {
                            "DataSource": {
                                "Properties": {
                                    "Container": "[variables('dataContainerName')]",
                                    "DateFormat": "yyyy-MM-dd",
                                    "TimeFormat": "HH",
                                    "PathPattern": "rawdata/date={date}/hour={time}",
                                    "StorageAccounts": [
                                        {
                                            "AccountKey": "[parameters('storageAccountKey')]",
                                            "AccountName": "[parameters('storageAccountName')]"
                                        }
                                    ]
                                },
                                "Type": "Microsoft.Storage/Blob"
                            },
                            "Serialization": {
                                "Properties": {
                                    "fieldDelimiter": ",",
                                    "Encoding": "UTF8"
                                },
                                "Type": "Csv"
                            }
                        }
                    }
                ],
                "transformation": {
                    "name": "PushDatatoBlob",
                    "properties": {
                        "streamingUnits": 1,
                        "query": "select * into RawDataBlobSink from EventHubSource"
                    }
                },
                "OutputStartMode": "CustomTime",
                "OutputStartTime": "[variables('startTime')]"
            }
        },
        {
            "apiVersion": "[variables('saVersion')]",
            "type": "Microsoft.StreamAnalytics/streamingJobs",
            "name": "[variables('pbiStreamingJobName')]",
            "location": "[variables('location')]",
            "properties": {
                "sku": {
                    "name": "standard"
                },
                "EventsOutOfOrderMaxDelayInSeconds": 10,
                "EventsOutOfOrderPolicy": "Adjust",
                "inputs": [
                    {
                        "name": "EventHubSource",
                        "properties": {
                            "type": "stream",
                            "Serialization": {
                                "Properties": {
                                    "fieldDelimiter": ",",
                                    "Encoding": "UTF8"
                                },
                                "Type": "Csv"
                            },
                            "datasource": {
                                "type": "Microsoft.ServiceBus/EventHub",
                                "properties": {
                                    "EventHubName": "[variables('ingestEventHubName')]",
                                    "ServiceBusNamespace": "[variables('namespaceName')]",
                                    "SharedAccessPolicyName": "[variables('sbKeyName')]",
                                    "SharedAccessPolicyKey": "[parameters('sharedAccessPolicyKey')]",
                                    "SourcePartitionCount": 16,
                                    "ConsumerGroupName": "[variables('blobConsumerGroupName')]"
                                }
                            }
                        }
                    }
                ],
                "Outputs": [
                    {
                        "Name": "Aircraftmonitor",
                        "Properties": {
                            "DataSource": {
                                "Properties": {
                                    "dataset": "[concat(resourceGroup().name, 'Aircraftmonitor')]",
                                    "table": "Aircraftmonitor",
                                    "refreshToken": "[variables('powerBiRefreshToken')]",
                                    "tokenUserPrincipalName": "[parameters('powerBiUserId')]",
                                    "tokenUserDisplayName": "[parameters('powerBiUserDisplayName')]",
                                    "groupId": "[variables('powerBiGroupId')]",
                                    "groupName": "[variables('powerBiWorkspaceName')]"
                                },
                                "Type": "PowerBI"
                            }
                        }
                    },
                    {
                        "Name": "Aircraftalert",
                        "Properties": {
                            "DataSource": {
                                "Properties": {
                                    "dataset": "[concat(resourceGroup().name, 'Aircraftalert')]",
                                    "table": "Aircraftalert",
                                    "refreshToken": "[variables('powerBiRefreshToken')]",
                                    "tokenUserPrincipalName": "[parameters('powerBiUserId')]",
                                    "tokenUserDisplayName": "[parameters('powerBiUserDisplayName')]",
                                    "groupId": "[variables('powerBiGroupId')]",
                                    "groupName": "[variables('powerBiWorkspaceName')]"
                                },
                                "Type": "PowerBI"
                            }
                        }
                    },
                    {
                        "Name": "Flightsbyhour",
                        "Properties": {
                            "DataSource": {
                                "Properties": {
                                    "dataset": "[concat(resourceGroup().name, 'Flightsbyhour')]",
                                    "table": "Flightsbyhour",
                                    "refreshToken": "[variables('powerBiRefreshToken')]",
                                    "tokenUserPrincipalName": "[parameters('powerBiUserId')]",
                                    "tokenUserDisplayName": "[parameters('powerBiUserDisplayName')]",
                                    "groupId": "[variables('powerBiGroupId')]",
                                    "groupName": "[variables('powerBiWorkspaceName')]"
                                },
                                "Type": "PowerBI"
                            }
                        }
                    }
                ],
                "transformation": {
                    "name": "PushDatatoPBI",
                    "properties": {
                        "streamingUnits": 1,
                        "query": "SELECT CAST(processed as Datetime) as processed,id,cycle,endofcycle,CAST(s9 as float) as s9,CAST(s11 as float) as s11,CAST(s14 as float) as s14,CAST(s15 as float) as s15,9152.56 as s9_alert,48.26 as s11_alert,8212.57 as s14_alert,8.54 as s15_alert INTO aircraftmonitor FROM EventHubSource; select id,max(CAST(processed as Datetime)) as processed,avg(s11) as avg_s11,count(*) as alerts INTO aircraftalert FROM EventHubSource Group BY id,TumblingWindow(second,5) HAVING avg_s11 > 48.26; select count(endofcycle),max(CAST(processed as Datetime)) as processed into Flightsbyhour from EventHubSource group by endofcycle, tumblingwindow(hour,1) having CAST(endofcycle as bigint)=1;"
                    }
                }
            }
        }
    ],
    "outputs": {
        "pbiOutputName": {
            "type": "string",
            "value": "PowerBIOutput"
        },
        "saJobOutputsUrl": {
            "type": "string",
            "value": "[concat('https://portal.azure.com/#resource/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.StreamAnalytics/streamingjobs/', variables('pbiStreamingJobName'), '/overview')]"
        }, 
        "saJobNames": {
            "type": "string",
            "value": "[variables('blobStreamingJobName')]"
        },
        "dataFactoryName": {
            "type": "string",
            "value": "[variables('dataFactoryName')]"
        },
        "dataFactoryUrl": {
            "type": "string",
            "value": "[concat('https://portal.azure.com/#resource/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.DataFactory/dataFactories/', variables('dataFactoryName'))]"
        },
        "webJobLogsUrl": {
            "type": "string",
            "value": "[concat('https://portal.azure.com/#resource/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/sites/', variables('functionAppName'))]"
        }
    }
}
